"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[182],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||i;return n?r.createElement(m,a(a({ref:t},p),{},{components:n})):r.createElement(m,a({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var u=2;u<i;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1524:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var r=n(7462),o=n(3366),i=(n(7294),n(3905)),a=["components"],s={sidebar_position:4},l="Twitter",u={unversionedId:"providers/twitter",id:"providers/twitter",isDocsHomePage:!1,title:"Twitter",description:"Implement twitter authentication in your NestJS application.",source:"@site/docs/providers/twitter.mdx",sourceDirName:"providers",slug:"/providers/twitter",permalink:"/nestjs-hybrid-auth/docs/providers/twitter",editUrl:"https://github.com/mjangir/nestjs-hybrid-auth/blob/main/website/docs/providers/twitter.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Google",permalink:"/nestjs-hybrid-auth/docs/providers/google"},next:{title:"Linkedin",permalink:"/nestjs-hybrid-auth/docs/providers/linkedin"}},p=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Install Express Session",id:"install-express-session",children:[{value:"In your main.ts file",id:"in-your-maints-file",children:[]}]},{value:"Install Actual Package",id:"install-actual-package",children:[]},{value:"How To Use?",id:"how-to-use",children:[]},{value:"Example Code For app.module.ts",id:"example-code-for-appmodulets",children:[{value:"Simple static configuration",id:"simple-static-configuration",children:[]},{value:"<code>useFactory</code> to get the ConfigService injected.",id:"usefactory-to-get-the-configservice-injected",children:[]},{value:"Use <code>useClass</code> to get your auth config from a class",id:"use-useclass-to-get-your-auth-config-from-a-class",children:[]}]},{value:"Example Code For Controller",id:"example-code-for-controller",children:[{value:"app.controller.ts",id:"appcontrollerts",children:[]}]},{value:"Exports",id:"exports",children:[{value:"UseTwitterAuth",id:"usetwitterauth",children:[]},{value:"TwitterAuthGuardOptions",id:"twitterauthguardoptions",children:[]},{value:"TwitterAuthModule",id:"twitterauthmodule",children:[]},{value:"TwitterAuthModuleOptions",id:"twitterauthmoduleoptions",children:[]},{value:"TwitterAuthModuleAsyncOptions",id:"twitterauthmoduleasyncoptions",children:[]},{value:"TwitterAuthModuleOptionsFactory",id:"twitterauthmoduleoptionsfactory",children:[]}]},{value:"Have Issues?",id:"have-issues",children:[]},{value:"Maintainers",id:"maintainers",children:[]}],c={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"twitter"},"Twitter"),(0,i.kt)("p",null,"Implement twitter authentication in your NestJS application."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"The library requires you to install few peer dependencies"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @nestjs/passport passport reflect-metadata --save\n")),(0,i.kt)("p",null,"OR"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @nestjs/passport passport reflect-metadata\n")),(0,i.kt)("h2",{id:"install-express-session"},"Install Express Session"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/twitter")," requires ",(0,i.kt)("inlineCode",{parentName:"p"},"express-session")," as a peer dependency and configure it your nest instance if you haven't."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install express-session --save\n")),(0,i.kt)("p",null,"OR"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add express-session\n")),(0,i.kt)("h3",{id:"in-your-maints-file"},"In your main.ts file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import * as session from 'express-session';\n\napp.use(\n  session({\n    secret: 'my-secret',\n    resave: false,\n    saveUninitialized: false,\n  })\n);\n")),(0,i.kt)("h2",{id:"install-actual-package"},"Install Actual Package"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @nestjs-hybrid-auth/twitter --save\n")),(0,i.kt)("p",null,"OR"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @nestjs-hybrid-auth/twitter\n")),(0,i.kt)("h2",{id:"how-to-use"},"How To Use?"),(0,i.kt)("p",null,"The package exports mainly a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/fundamentals/dynamic-modules"},"dynamic module")," and ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/guards"},"guard"),". The module should be imported in your app.module.ts and guards should be used on the route handlers of any controller."),(0,i.kt)("h2",{id:"example-code-for-appmodulets"},"Example Code For app.module.ts"),(0,i.kt)("h3",{id:"simple-static-configuration"},"Simple static configuration"),(0,i.kt)("p",null,"Want to jump directly to the ",(0,i.kt)("a",{parentName:"p",href:"#twitterauthmoduleoptions"},"available options"),"?"),(0,i.kt)("p",null,"If you just want to provide the static values or have them handy, pass them as options to the ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," static method like below. The options object is type of ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModuleOptions"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TwitterAuthModule } from '@nestjs-hybrid-auth/twitter';\n\n@Module({\n  imports: [\n    TwitterAuthModule.forRoot({\n      consumerKey: process.env.CONSUMER_KEY,\n      consumerSecret: process.env.CONSUMER_SECRET,\n      callbackURL: process.env.CALLBACK_URL,\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n")),(0,i.kt)("h3",{id:"usefactory-to-get-the-configservice-injected"},(0,i.kt)("inlineCode",{parentName:"h3"},"useFactory")," to get the ConfigService injected."),(0,i.kt)("p",null,"If you want to make use of nest's ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/techniques/configuration#installation"},"ConfigModule")," to get the auth configuration for a provider from ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," config files, use ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static method. The options to this method are typeof ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModuleAsyncOptions")," which accepts a ",(0,i.kt)("inlineCode",{parentName:"p"},"useFactory")," property. ",(0,i.kt)("inlineCode",{parentName:"p"},"useFactory")," is a function which gets the instances injected whatever has been provided in ",(0,i.kt)("inlineCode",{parentName:"p"},"inject")," array. You can use those instances to prepare and return the actual ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModuleOptions")," object. ConfigService can be one of them as per your choice."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TwitterAuthModule } from '@nestjs-hybrid-auth/twitter';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      cache: true,\n      expandVariables: true,\n    }),\n    TwitterAuthModule.forRootAsync({\n      imports: [ConfigModule],\n      inject: [ConfigService],\n      useFactory: (configService: ConfigService) => ({\n        consumerKey: configService.get('TWITTER_CLIENT_ID'),\n        consumerSecret: configService.get('TWITTER_CLIENT_SECRET'),\n        callbackURL: configService.get('TWITTER_CALLBACK_URL'),\n      }),\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n")),(0,i.kt)("h3",{id:"use-useclass-to-get-your-auth-config-from-a-class"},"Use ",(0,i.kt)("inlineCode",{parentName:"h3"},"useClass")," to get your auth config from a class"),(0,i.kt)("p",null,"If the ",(0,i.kt)("inlineCode",{parentName:"p"},"useFactory")," makes your app module bloated with a lot of boilerplate code, you can ",(0,i.kt)("inlineCode",{parentName:"p"},"useClass")," to provide an existing config provider class. The class must implement ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModuleOptionsFactory")," interface and ",(0,i.kt)("inlineCode",{parentName:"p"},"createModuleOptions")," method. This method should return ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModuleOptions")," object. Similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"useFactory"),", whatever you provide in ",(0,i.kt)("inlineCode",{parentName:"p"},"inject")," array, it will get injected in the constructor of your class. Follow the example:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"hybrid-auth.config.ts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { ConfigService } from '@nestjs/config';\nimport {\n  TwitterAuthModuleOptions,\n  TwitterAuthModuleOptionsFactory,\n} from '@nestjs-hybrid-auth/twitter';\n\n@Injectable()\nclass TwitterAuthConfig implements TwitterAuthModuleOptionsFactory {\n  constructor(private configService: ConfigService) {}\n\n  createModuleOptions(): TwitterAuthModuleOptions {\n    return {\n      consumerKey: this.configService.get('TWITTER_CLIENT_ID'),\n      consumerSecret: this.configService.get('TWITTER_CLIENT_SECRET'),\n      callbackURL: this.configService.get('TWITTER_CALLBACK_URL'),\n    };\n  }\n}\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"app.module.ts")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TwitterAuthModule } from '@nestjs-hybrid-auth/twitter';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      cache: true,\n      expandVariables: true,\n    }),\n    TwitterAuthModule.forRootAsync({\n      imports: [ConfigModule],\n      inject: [ConfigService],\n      useClass: TwitterAuthConfig,\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n")),(0,i.kt)("h2",{id:"example-code-for-controller"},"Example Code For Controller"),(0,i.kt)("p",null,"Once you have setup the module properly in module file, its time to configure your route handlers to make the user properly redirected to appropriate identity provider's login page. ",(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/twitter")," provides a guard and result interface to make it enabled."),(0,i.kt)("p",null,"Each route will have two variants. One is to redirect to social login page and the other is to collect the response such as access/refresh tokens and user profile etc. The result will be attached to ",(0,i.kt)("inlineCode",{parentName:"p"},"Request")," object's ",(0,i.kt)("inlineCode",{parentName:"p"},"hybridAuthResult")," property as shown in the example below."),(0,i.kt)("h3",{id:"appcontrollerts"},"app.controller.ts"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { UseTwitterAuth, TwitterAuthResult } from '@nestjs-hybrid-auth/twitter';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @UseTwitterAuth()\n  @Get('auth/twitter')\n  loginWithTwitter() {\n    return 'Login with Twitter';\n  }\n\n  @UseTwitterAuth()\n  @Get('auth/twitter-login/callback')\n  twitterCallback(@Request() req): Partial<TwitterAuthResult> {\n    const result: TwitterAuthResult = req.hybridAuthResult;\n    return {\n      accessToken: result.accessToken,\n      refreshToken: result.refreshToken,\n      profile: result.profile,\n    };\n  }\n}\n")),(0,i.kt)("h2",{id:"exports"},"Exports"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/twitter")," exports various decorators, interfaces and methods."),(0,i.kt)("h3",{id:"usetwitterauth"},"UseTwitterAuth"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"UseTwitterAuth")," is NestJS ",(0,i.kt)("inlineCode",{parentName:"p"},"Guard")," which hijacks your nest request and redirects users to the appropriate login page of your configured identity provider (twitter in this case). The same guard can be used on ",(0,i.kt)("inlineCode",{parentName:"p"},"callback")," route also as shown in the example above. In the callback route handler, the ",(0,i.kt)("inlineCode",{parentName:"p"},"req: Request")," object will have a property ",(0,i.kt)("inlineCode",{parentName:"p"},"hybridAuthResult")," which is an object of type ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthResult"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@UseTwitterAuth(options: TwitterAuthGuardOptions)\n@Get('auth/twitter')\nloginWithTwitter() {\n  return 'Login with Twitter';\n}\n")),(0,i.kt)("h3",{id:"twitterauthguardoptions"},"TwitterAuthGuardOptions"),(0,i.kt)("p",null,"This is a simple object to be passed into ",(0,i.kt)("inlineCode",{parentName:"p"},"UseTwitterAuth")," guard as shown in example above if you want to pass some extra parameters to query the twitter result. It can be left empty for default result."),(0,i.kt)("h3",{id:"twitterauthmodule"},"TwitterAuthModule"),(0,i.kt)("p",null,"This is the dynamic module which must be imported in your app's main module with ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static methods whichever suits your need. Both will return a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/fundamentals/dynamic-modules"},"NestJS dynamic module"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TwitterAuthModule {\n  forRoot(options: TwitterAuthModuleOptions): DynamicModule;\n  forRootAsync(options: TwitterAuthModuleAsyncOptions): DynamicModule;\n}\n")),(0,i.kt)("h3",{id:"twitterauthmoduleoptions"},"TwitterAuthModuleOptions"),(0,i.kt)("p",null,"If you are configuring your module with ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," static method, pass in the module options given below. They can be called the twitter passport strategy options also."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TwitterAuthModuleOptions {\n  consumerKey: string;\n  consumerSecret: string;\n  callbackURL: string;\n\n  includeEmail?: boolean | undefined;\n  includeStatus?: boolean | undefined;\n  includeEntities?: boolean | undefined;\n\n  requestTokenURL?: string | undefined;\n  accessTokenURL?: string | undefined;\n  userAuthorizationURL?: string | undefined;\n  sessionKey?: string | undefined;\n\n  forceLogin?: boolean | undefined;\n  screenName?: string | undefined;\n\n  userProfileURL?: string | undefined;\n  skipExtendedUserProfile?: boolean | undefined;\n}\n")),(0,i.kt)("h3",{id:"twitterauthmoduleasyncoptions"},"TwitterAuthModuleAsyncOptions"),(0,i.kt)("p",null,"If you want to configure the ",(0,i.kt)("inlineCode",{parentName:"p"},"TwitterAuthModule")," dynamically having the config or other services injected, pass in async options in the ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static method. Please refer to the example above for ",(0,i.kt)("inlineCode",{parentName:"p"},"useFactory")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"useClass")," properties."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TwitterAuthModuleAsyncOptions {\n  useExisting?: Type<TwitterAuthModuleOptionsFactory>;\n  useClass?: Type<TwitterAuthModuleOptionsFactory>;\n  useFactory?: (\n    ...args: any[]\n  ) => Promise<TwitterAuthModuleOptions> | TwitterAuthModuleOptions;\n  inject?: any[];\n}\n")),(0,i.kt)("h3",{id:"twitterauthmoduleoptionsfactory"},"TwitterAuthModuleOptionsFactory"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TwitterAuthModuleOptionsFactory {\n  createModuleOptions():\n    | Promise<TwitterAuthModuleOptions>\n    | TwitterAuthModuleOptions;\n}\n")),(0,i.kt)("h2",{id:"have-issues"},"Have Issues?"),(0,i.kt)("p",null,"If you still have trouble setting up the workflow properly, please file an issue at ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mjangir/nestjs-hybrid-auth/issues"},"Issues")," page."),(0,i.kt)("h2",{id:"maintainers"},"Maintainers"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/mjangir"},"Manish Jangir")))}d.isMDXComponent=!0}}]);