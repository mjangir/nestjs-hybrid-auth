"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[820],{3905:function(e,o,t){t.d(o,{Zo:function(){return c},kt:function(){return h}});var n=t(7294);function r(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function a(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){r(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function l(e,o){if(null==e)return{};var t,n,r=function(e,o){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],o.indexOf(t)>=0||(r[t]=e[t]);return r}(e,o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var o=n.useContext(s),t=o;return e&&(t="function"==typeof e?e(o):a(a({},o),e)),t},c=function(e){var o=u(e.components);return n.createElement(s.Provider,{value:o},e.children)},p={inlineCode:"code",wrapper:function(e){var o=e.children;return n.createElement(n.Fragment,{},o)}},d=n.forwardRef((function(e,o){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(t),h=r,f=d["".concat(s,".").concat(h)]||d[h]||p[h]||i;return t?n.createElement(f,a(a({ref:o},c),{},{components:t})):n.createElement(f,a({ref:o},c))}));function h(e,o){var t=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=d;var l={};for(var s in o)hasOwnProperty.call(o,s)&&(l[s]=o[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var u=2;u<i;u++)a[u]=t[u];return n.createElement.apply(null,a)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9270:function(e,o,t){t.r(o),t.d(o,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var n=t(7462),r=t(3366),i=(t(7294),t(3905)),a=["components"],l={sidebar_position:1},s="All In One",u={unversionedId:"providers/all-in-one",id:"providers/all-in-one",isDocsHomePage:!1,title:"All In One",description:"Implement various social identity provider authentication in your NestJS application for e.g. Google, Facebook, Twitter and many more.",source:"@site/docs/providers/all-in-one.mdx",sourceDirName:"providers",slug:"/providers/all-in-one",permalink:"/nestjs-hybrid-auth/docs/providers/all-in-one",editUrl:"https://github.com/mjangir/nestjs-hybrid-auth/blob/main/website/docs/providers/all-in-one.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"How To Use?",permalink:"/nestjs-hybrid-auth/docs/introduction/how-to-use"},next:{title:"Facebook",permalink:"/nestjs-hybrid-auth/docs/providers/facebook"}},c=[{value:"Install",id:"install",children:[]},{value:"How To Use?",id:"how-to-use",children:[]},{value:"Sync Module Configuration",id:"sync-module-configuration",children:[]},{value:"Async Module Configuration",id:"async-module-configuration",children:[{value:"Example <code>useFactory</code>",id:"example-usefactory",children:[]},{value:"Example <code>useClass</code>",id:"example-useclass",children:[]}]},{value:"Controller Configuration",id:"controller-configuration",children:[]},{value:"Exports For Module File",id:"exports-for-module-file",children:[{value:"HybridAuthModule",id:"hybridauthmodule",children:[]},{value:"HybridAuthModuleOptions",id:"hybridauthmoduleoptions",children:[]},{value:"HybridAuthModuleAsyncOptions",id:"hybridauthmoduleasyncoptions",children:[]}]},{value:"Exports For Controller File",id:"exports-for-controller-file",children:[]},{value:"Have Issues?",id:"have-issues",children:[]},{value:"Maintainers",id:"maintainers",children:[]}],p={toc:c};function d(e){var o=e.components,t=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,n.Z)({},p,t,{components:o,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"all-in-one"},"All In One"),(0,i.kt)("p",null,"Implement various social identity provider authentication in your NestJS application for e.g. Google, Facebook, Twitter and many more."),(0,i.kt)("h2",{id:"install"},"Install"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @nestjs-hybrid-auth/all --save\n")),(0,i.kt)("p",null,"OR"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @nestjs-hybrid-auth/all\n")),(0,i.kt)("h2",{id:"how-to-use"},"How To Use?"),(0,i.kt)("p",null,"This package is an assembling of all the individual nestjs hybrid auth provider packages and exports one single ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/fundamentals/dynamic-modules"},"dynamic nestjs module"),". The module takes configuration for all social providers both synchronously and asynchronously using ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static methods."),(0,i.kt)("h2",{id:"sync-module-configuration"},"Sync Module Configuration"),(0,i.kt)("p",null,"If you have all of your social providers credentials and configuration handy in an object, just pass them in ",(0,i.kt)("inlineCode",{parentName:"p"},".forRoot")," static method to register the module. The options object is type of ",(0,i.kt)("inlineCode",{parentName:"p"},"HybridAuthModuleOptions"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { HybridAuthModule } from '@nestjs-hybrid-auth/all';\n\n@Module({\n  imports: [\n    HybridAuthModule.forRoot({\n      google: {\n        clientID: process.env.GOOGLE_CLIENT_ID,\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n        callbackURL: process.env.GOOGLE_CALLBACK_URL,\n      },\n      facebook: {\n        clientID: process.env.FACEBOOK_CLIENT_ID,\n        clientSecret: process.env.FACEBOOK_CLIENT_SECRET,\n        callbackURL: process.env.FACEBOOK_CALLBACK_URL,\n      },\n      // Rest of the providers\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n")),(0,i.kt)("h2",{id:"async-module-configuration"},"Async Module Configuration"),(0,i.kt)("p",null,"If you get the configurations for each identity provider asynchronously through any config service or so, use ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static method to load them. The options would be same but value for each provider would be their AsyncOptions equivalent. Please refer to below code:"),(0,i.kt)("h3",{id:"example-usefactory"},"Example ",(0,i.kt)("inlineCode",{parentName:"h3"},"useFactory")),(0,i.kt)("p",null,"It is same as ",(0,i.kt)("a",{parentName:"p",href:"./facebook#usefactory-to-get-the-configservice-injected"},"this config")," on Facebook page."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Module } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport {\n  HybridAuthModule,\n  FacebookAuthModuleOptions,\n} from '@nestjs-hybrid-auth/all';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      cache: true,\n      expandVariables: true,\n    }),\n    HybridAuthModule.forRootAsync({\n      facebook: {\n        useFactory: (\n          configService: ConfigService\n        ): FacebookAuthModuleOptions => ({\n          clientID: configService.get('FACEBOOK_CLIENT_ID'),\n          clientSecret: configService.get('FACEBOOK_CLIENT_SECRET'),\n          callbackURL: configService.get('FACEBOOK_CALLBACK_URL'),\n        }),\n        inject: [ConfigService],\n      },\n      // Rest of the providers\n    }),\n  ],\n})\nexport class AllAsyncFactoryModule {}\n")),(0,i.kt)("h3",{id:"example-useclass"},"Example ",(0,i.kt)("inlineCode",{parentName:"h3"},"useClass")),(0,i.kt)("p",null,"It is same as ",(0,i.kt)("a",{parentName:"p",href:"./facebook#use-useclass-to-get-your-auth-config-from-a-class"},"this config")," on Facebook page."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Module, Injectable } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport {\n  HybridAuthModule,\n  FacebookAuthModuleOptions,\n  FacebookAuthModuleOptionsFactory,\n} from '@nestjs-hybrid-auth/all';\n\n// We create a config provider class for useClass\n@Injectable()\nexport class FacebookAuthConfig implements FacebookAuthModuleOptionsFactory {\n  constructor(private configService: ConfigService) {}\n\n  createModuleOptions(): FacebookAuthModuleOptions {\n    return {\n      clientID: this.configService.get('FACEBOOK_CLIENT_ID'),\n      clientSecret: this.configService.get('FACEBOOK_CLIENT_SECRET'),\n      callbackURL: this.configService.get('FACEBOOK_CALLBACK_URL'),\n    };\n  }\n}\n\n// Actual app module\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      cache: true,\n      expandVariables: true,\n    }),\n    HybridAuthModule.forRootAsync({\n      facebook: {\n        useClass: FacebookAuthConfig,\n      },\n      // Rest of the providers\n    }),\n  ],\n})\nexport class AllAsyncClassModule {}\n")),(0,i.kt)("h2",{id:"controller-configuration"},"Controller Configuration"),(0,i.kt)("p",null,"Once you have setup the module properly in module file, its time to configure your route handlers to make the user properly redirected to appropriate identity provider's login page. ",(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/all")," exports route handler guards for all identity providers it supports from ",(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/<identity-provider>")," where ",(0,i.kt)("inlineCode",{parentName:"p"},"identity-provider")," can be ",(0,i.kt)("inlineCode",{parentName:"p"},"facebook/google/linkedin/twitter")," etc."),(0,i.kt)("p",null,"Each route will have two variants. One is to redirect to social login page and the other is to collect the response such as access/refresh tokens and user profile etc. The result will be attached to ",(0,i.kt)("inlineCode",{parentName:"p"},"Request")," object's ",(0,i.kt)("inlineCode",{parentName:"p"},"hybridAuthResult")," property as shown in the example below."),(0,i.kt)("h4",{id:"this-controller-examples-shows-facebook-login-using-hybrid-auth"},"This controller examples shows facebook login using hybrid auth."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { UseFacebookAuth, FacebookAuthResult } from '@nestjs-hybrid-auth/all';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @UseFacebookAuth()\n  @Get('auth/facebook')\n  loginWithFacebook() {\n    return 'Login with Facebook';\n  }\n\n  @UseFacebookAuth()\n  @Get('auth/facebook-login/callback')\n  facebookCallback(@Request() req): Partial<FacebookAuthResult> {\n    const result: FacebookAuthResult = req.hybridAuthResult;\n    return {\n      accessToken: result.accessToken,\n      refreshToken: result.refreshToken,\n      profile: result.profile,\n    };\n  }\n}\n")),(0,i.kt)("h2",{id:"exports-for-module-file"},"Exports For Module File"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/all")," exports various interfaces and methods for module registration."),(0,i.kt)("h3",{id:"hybridauthmodule"},"HybridAuthModule"),(0,i.kt)("p",null,"This is the dynamic module which must be imported in your app's main module with ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"forRootAsync")," static methods whichever suits your need. Both will return a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/fundamentals/dynamic-modules"},"NestJS dynamic module"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface HybridAuthModule {\n  forRoot(options: HybridAuthModuleOptions): DynamicModule;\n  forRootAsync(options: HybridAuthModuleAsyncOptions): DynamicModule;\n}\n")),(0,i.kt)("h3",{id:"hybridauthmoduleoptions"},"HybridAuthModuleOptions"),(0,i.kt)("p",null,"If you are configuring your module with ",(0,i.kt)("inlineCode",{parentName:"p"},"forRoot")," static method, pass in the module options given below. The options object is just a container for various identity providers strategy options."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface HybridAuthModuleOptions {\n  google: GoogleAuthModuleOptions;\n  facebook: FacebookAuthModuleOptions;\n  // List goes on for other providers\n}\n")),(0,i.kt)("h3",{id:"hybridauthmoduleasyncoptions"},"HybridAuthModuleAsyncOptions"),(0,i.kt)("p",null,"If you want to provide the async configurations for each identity provider, use the following ",(0,i.kt)("inlineCode",{parentName:"p"},"HybridAuthModuleAsyncOptions")," object."),(0,i.kt)("p",null,"The value of each provider is ",(0,i.kt)("a",{parentName:"p",href:"./facebook#facebookauthmoduleasyncoptions"},"kind of this")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface HybridAuthModuleAsyncOptions {\n  google: GoogleAuthModuleAsyncOptions;\n  facebook: FacebookAuthModuleAsyncOptions;\n  // List goes on for other providers\n}\n")),(0,i.kt)("h2",{id:"exports-for-controller-file"},"Exports For Controller File"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/all")," just re-exports all the authentication route guards and result interfaces from all the individual identity providers. For more information, you can check the documentation for any provider for e.g.",(0,i.kt)("inlineCode",{parentName:"p"},"@nestjs-hybrid-auth/google"),"."),(0,i.kt)("h2",{id:"have-issues"},"Have Issues?"),(0,i.kt)("p",null,"If you still have trouble setting up the workflow properly, please file an issue at ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mjangir/nestjs-hybrid-auth/issues"},"Issues")," page."),(0,i.kt)("h2",{id:"maintainers"},"Maintainers"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/mjangir"},"Manish Jangir")))}d.isMDXComponent=!0}}]);